<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ | Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%232563eb;stop-opacity:1' /><stop offset='100%25' style='stop-color:%231d4ed8;stop-opacity:1' /></linearGradient></defs><circle cx='50' cy='50' r='45' fill='url(%23grad)'/><text x='50' y='40' font-family='Arial, sans-serif' font-size='24' font-weight='900' fill='white' text-anchor='middle'>MaaS</text><text x='50' y='65' font-family='Arial, sans-serif' font-size='8' font-weight='600' fill='white' text-anchor='middle'>Ù‚ÙŠØ§Ø³Ø§Øª Ø°ÙƒÙŠØ©</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%232563eb;stop-opacity:1' /><stop offset='100%25' style='stop-color:%231d4ed8;stop-opacity:1' /></linearGradient></defs><rect width='100' height='100' rx='20' fill='url(%23grad)'/><text x='50' y='65' font-family='Arial, sans-serif' font-size='40' font-weight='900' fill='white' text-anchor='middle'>MaaS</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1d4ed8;
            --success: #16a34a;
            --warning: #ea580c;
            --danger: #dc2626;
            --info: #0891b2;
            --dark: #1f2937;
            --light: #f9fafb;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --card: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--text);
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 420px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        h1 { font-size: 1.6rem; margin: 0 0 10px 0; color: var(--primary); font-weight: 800; }
        p.sub { color: var(--text-light); margin: 0 0 25px 0; font-size: 0.95rem; }
        .tabs { display: flex; gap: 10px; margin-bottom: 25px; }
        .tabs button {
            flex: 1;
            padding: 12px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 12px;
            font-family: Cairo, sans-serif;
            font-weight: 700;
            cursor: pointer;
            color: var(--text-light);
        }
        .tabs button.active { border-color: var(--primary); color: var(--primary); background: #eef2ff; }
        .form { display: none; }
        .form.active { display: block; }
        label { display: block; font-weight: 700; margin-bottom: 8px; font-size: 0.9rem; }
        input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: Cairo, sans-serif;
            margin-bottom: 18px;
        }
        input:focus { outline: none; border-color: var(--primary); }
        .btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: Cairo, sans-serif;
            font-weight: 800;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 5px;
        }
        .btn:hover { opacity: 0.95; }
        .msg { padding: 12px; border-radius: 10px; margin-bottom: 18px; font-size: 0.9rem; display: none; }
        .msg.show { display: block; }
        .msg.err { background: #fef2f2; color: #b91c1c; }
        .msg.ok { background: #f0fdf4; color: #15803d; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</h1>
        <p class="sub">Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£Ùˆ Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹</p>

        <div class="tabs">
            <button type="button" id="tab-login" class="active">Ø¯Ø®ÙˆÙ„</button>
            <button type="button" id="tab-signup">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        </div>

        <div id="msg" class="msg"></div>

        <form id="form-login" class="form active">
            <label for="login-email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" id="login-email" placeholder="example@email.com" required>
            <label for="login-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input type="password" id="login-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
            <button type="submit" class="btn">Ø¯Ø®ÙˆÙ„</button>
        </form>

        <form id="form-signup" class="form">
            <label for="signup-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
            <input type="text" id="signup-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" required>
            <label for="signup-email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" id="signup-email" placeholder="example@email.com" required>
            <label for="signup-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)</label>
            <input type="password" id="signup-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6" required>
            <label for="signup-role">Ø£Ù†Ø§</label>
            <select id="signup-role" style="width:100%; padding:14px; border:2px solid #e2e8f0; border-radius:12px; font-family:Cairo; margin-bottom:18px;">
                <option value="student">Ø·Ø§Ù„Ø¨</option>
                <option value="teacher">Ù…Ø¹Ù„Ù…</option>
            </select>
            <button type="submit" class="btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        </form>
    </div>

    <script>
        const _supabase = supabase.createClient(
            'https://hnldjfcvztnrhkwjmetf.supabase.co',
            'sb_publishable_ldtY51QgRs0yg8sxnqhIkA_0qKvVXMU'
        );

        const msgEl = document.getElementById('msg');
        const tabLogin = document.getElementById('tab-login');
        const tabSignup = document.getElementById('tab-signup');
        const formLogin = document.getElementById('form-login');
        const formSignup = document.getElementById('form-signup');

        function showMsg(text, isError) {
            msgEl.textContent = text;
            msgEl.className = 'msg show ' + (isError ? 'err' : 'ok');
        }

        tabLogin.onclick = function() {
            tabLogin.classList.add('active');
            tabSignup.classList.remove('active');
            formLogin.classList.add('active');
            formSignup.classList.remove('active');
            msgEl.classList.remove('show');
        };
        tabSignup.onclick = function() {
            tabSignup.classList.add('active');
            tabLogin.classList.remove('active');
            formSignup.classList.add('active');
            formLogin.classList.remove('active');
            msgEl.classList.remove('show');
        };

        formLogin.onsubmit = async function(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            showMsg('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...', false);
            const { data, error } = await _supabase.auth.signInWithPassword({ email, password });
            if (error) {
                showMsg('ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, true);
                return;
            }
            
            // Check user role and redirect accordingly
            const userMetadata = data.user.user_metadata || {};
            const role = userMetadata.role || 'student';
            
            showMsg('ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...', false);
            setTimeout(function() {
                if (role === 'teacher') {
                    window.location.href = 'teacher_dashboard.html';
                } else {
                    window.location.href = 'student_dashboard.html';
                }
            }, 800);
        };

        formSignup.onsubmit = async function(e) {
            e.preventDefault();
            const fullName = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const role = document.getElementById('signup-role').value;
            showMsg('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...', false);
            
            const { data, error } = await _supabase.auth.signUp({
                email,
                password,
                options: {
                    data: {
                        full_name: fullName,
                        role: role,
                        user_type: role
                    }
                }
            });

            if (error) {
                showMsg('ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + error.message, true);
                return;
            }

            showMsg('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ...', false);
            
            // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            setTimeout(function() {
                if (role === 'teacher') {
                    window.location.href = 'teacher_dashboard.html';
                } else {
                    window.location.href = 'student_dashboard.html';
                }
            }, 1500);
        };
    </script>
</body>
</html>
